<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CCTV Designer Tool</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #f4f4f4;
  }
  .dashboard {
    display: flex;
    width: 100%;
    height: 100vh;
  }
  .sidebar {
    width: 220px;
    background-color: #2c3e50;
    color: #fff;
    padding: 20px;
  }
  .sidebar h2 {
    font-size: 20px;
    border-bottom: 1px solid #444;
    padding-bottom: 10px;
    margin-bottom: 15px;
  }
  .sidebar button {
    background-color: #34495e;
    color: white;
    border: none;
    padding: 10px;
    width: 100%;
    margin: 5px 0;
    cursor: pointer;
    text-align: left;
  }
  .sidebar button:hover {
    background-color: #1abc9c;
  }
  .designer {
    flex-grow: 1;
    background-color: #ecf0f1;
    position: relative;
    overflow: hidden;
  }
  canvas {
    background-color: #fff;
    border: 1px solid #ccc;
    display: block;
    margin: 20px auto;
  }
  #pricingModal {
    position: absolute;
    top: 20%;
    left: 40%;
    background: white;
    border: 2px solid #555;
    padding: 20px;
    display: none;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
  }
</style>
</head>
<body>

<div class="dashboard">
  <div class="sidebar">
    <h2>Tools</h2>
    <button onclick="newProject()">üÜï New Project</button>
    <button onclick="addMap()">üó∫Ô∏è Add Map</button>
    <button onclick="uploadImage()">üìÅ Upload Image</button>
    <button onclick="toggleDraw()">‚úèÔ∏è Draw</button>
    <button onclick="insertCamera()">üì∑ Insert Camera</button>
    <button onclick="drawNetwork()">üîó Network Diagram</button>
    <button onclick="showPricing()">üí≤ Pricing</button>
    <input type="file" id="imageUpload" accept="image/*" style="display:none" onchange="handleImageUpload(event)">
  </div>

  <div class="designer">
    <canvas id="designerCanvas" width="1000" height="700"></canvas>
    <div id="pricingModal">
      <h3>Project Pricing</h3>
      <p id="pricingText"></p>
      <button onclick="closePricing()">Close</button>
    </div>
  </div>
</div>

<script>
  const canvas = document.getElementById('designerCanvas');
  const ctx = canvas.getContext('2d');
  let drawing = false;
  let drawMode = false;
  let backgroundImage = null;
  let cameras = [];
  let draggingCamera = null;
  let offsetX, offsetY;
  let showNetworkDiagramActive = false;

  // üÜï New Project
  function newProject() {
    if (confirm("Start a new project? All progress will be lost.")) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      backgroundImage = null;
      cameras = [];
      drawScene();
    }
  }

  // üó∫Ô∏è Add Map (user enters a URL)
  function addMap() {
    const url = prompt("Paste the image URL of the map or background:");
    if (url) {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.onload = () => {
        backgroundImage = img;
        drawScene();
      };
      img.src = url;
    }
  }

  // üìÅ Upload Image
  function uploadImage() {
    document.getElementById('imageUpload').click();
  }

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    const img = new Image();
    img.onload = () => {
      backgroundImage = img;
      drawScene();
    };
    img.src = URL.createObjectURL(file);
  }

  // ‚úèÔ∏è Draw Mode
  function toggleDraw() {
    drawMode = !drawMode;
    alert(drawMode ? "Draw mode enabled ‚Äî hold mouse to draw." : "Draw mode disabled");
  }

  // üì∑ Insert Camera
  function insertCamera() {
    const x = Math.random() * (canvas.width - 40) + 20;
    const y = Math.random() * (canvas.height - 40) + 20;
    cameras.push({ x, y, label: "CAM " + (cameras.length + 1) });
    drawScene();
  }

  // üîó Network Diagram
  function drawNetwork() {
    showNetworkDiagramActive = !showNetworkDiagramActive;
    drawScene();
  }

  // üí≤ Pricing
  function showPricing() {
    const modal = document.getElementById('pricingModal');
    const pricePerCamera = 100;
    const total = cameras.length * pricePerCamera;
    document.getElementById('pricingText').innerText =
      `Cameras: ${cameras.length}\nEstimated Cost: $${total}`;
    modal.style.display = 'block';
  }

  function closePricing() {
    document.getElementById('pricingModal').style.display = 'none';
  }

  // Canvas Drawing & Camera Dragging
  canvas.addEventListener('mousedown', (e) => {
    const { offsetX: x, offsetY: y } = e;
    if (drawMode) {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(x, y);
    } else {
      // Camera dragging
      for (let cam of cameras) {
        if (Math.abs(cam.x - x) < 20 && Math.abs(cam.y - y) < 20) {
          draggingCamera = cam;
          offsetX = x - cam.x;
          offsetY = y - cam.y;
          return;
        }
      }
    }
  });

  canvas.addEventListener('mousemove', (e) => {
    const { offsetX: x, offsetY: y } = e;
    if (drawMode && drawing) {
      ctx.lineTo(x, y);
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.stroke();
    } else if (draggingCamera) {
      draggingCamera.x = x - offsetX;
      draggingCamera.y = y - offsetY;
      drawScene();
    }
  });

  canvas.addEventListener('mouseup', () => {
    drawing = false;
    draggingCamera = null;
  });

  function drawScene() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (backgroundImage) {
      ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
    }

    // Draw cameras
    for (let cam of cameras) {
      ctx.beginPath();
      ctx.arc(cam.x, cam.y, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "red";
      ctx.fill();
      ctx.font = "12px Arial";
      ctx.fillStyle = "black";
      ctx.fillText(cam.label, cam.x + 12, cam.y + 4);
    }

    // Draw network lines (if active)
    if (showNetworkDiagramActive && cameras.length > 0) {
      const nvrX = canvas.width - 100;
      const nvrY = canvas.height / 2;
      ctx.fillStyle = "blue";
      ctx.fillRect(nvrX - 20, nvrY - 20, 40, 40);
      ctx.fillStyle = "white";
      ctx.fillText("NVR", nvrX - 10, nvrY + 4);

      ctx.strokeStyle = "gray";
      cameras.forEach(cam => {
        ctx.beginPath();
        ctx.moveTo(cam.x, cam.y);
        ctx.lineTo(nvrX, nvrY);
        ctx.stroke();
      });
    }
  }

  drawScene();
</script>
</body>
</html>
