    <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Address Field</title>
  <style>
    .pac-container { z-index: 1050; }
    .error { color: #d32f2f; font-size: .85rem;  }
  </style>
</head>
<body>

<form id="addressForm">
  <label for="address">Full address:</label><br>
  <input type="text" id="address" placeholder="Start typing…" autocomplete="off" required>
  <div id="errorMsg" class="error"></div><br><br>

  <button type="submit">Submit</button>
</form>

<!-- Google Places script (replace YOUR_API_KEY) -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
<script>
  // ---------- 1. Autocomplete + typo-tolerant suggestions ----------
  const input = document.getElementById('address');
  const autocomplete = new google.maps.places.Autocomplete(input, {
    types: ['geocode'],               // full addresses
    fields: ['formatted_address', 'geometry', 'address_components']
  });

  // Listen for a selection
  autocomplete.addListener('place_changed', () => {
    const place = autocomplete.getPlace();
    if (!place.geometry) return;

    // Replace the input with the *official* formatted address
    input.value = place.formatted_address;
    clearError();
  });

  // ---------- 2. Real-time typo correction ----------
  const COMMON_TYPO_MAP = {
    'streeet': 'Street',
    'stret':   'Street',
    'str':     'Street',
    'ave':     'Avenue',
    'blvd':    'Boulevard',
    'rd':      'Road',
    'dr':      'Drive',
    'mat':     'Main',          // your example
    'mian':    'Main',
    // add more as needed…
  };

  input.addEventListener('input', () => {
    let val = input.value;

    // ---- a) Simple word-level typo fix ----
    Object.entries(COMMON_TYPO_MAP).forEach(([bad, good]) => {
      const regex = new RegExp(`\\b${bad}\\b`, 'gi');
      val = val.replace(regex, good);
    });

    // ---- b) Capitalize after numbers (123 main → 123 Main) ----
    val = val.replace(/(\d+)\s+([a-z])/gi, (m, n, w) => `${n} ${w.toUpperCase()}`);

    if (val !== input.value) {
      input.value = val;               // silently correct
      // move cursor to end
      input.setSelectionRange(val.length, val.length);
    }
  });

  // ---------- 3. Final validation on submit ----------
  const form = document.getElementById('addressForm');
  const errorDiv = document.getElementById('errorMsg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearError();

    const raw = input.value.trim();
    if (!raw) return showError('Address is required');

    // Use the Places "find place" endpoint for a final sanity-check
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({ address: raw }, (results, status) => {
      if (status === 'OK' && results[0]) {
        const corrected = results[0].formatted_address;
        if (corrected !== raw) {
          if (confirm(`Did you mean:\n${corrected}\n\nClick OK to use this address.`)) {
            input.value = corrected;
          }
        }
        // Proceed with form (or AJAX) – here we just alert
        alert(`Final address:\n${input.value}`);
      } else {
        showError('Could not verify this address. Please check spelling.');
      }
    });
  });

  function showError(msg) {
    errorDiv.textContent = msg;
  }
  function clearError() {
    errorDiv.textContent = '';
  }
</script>

</body>
</html>
